<!DOCTYPE html>
<html lang="ru">
  <head>
    <meta charset="UTF-8" />
    <title>–û—Ç–ø—Ä–∞–≤–∏—Ç—å –ø—Ä–∏–≥–ª–∞—Å–∏—Ç–µ–ª—å–Ω–æ–µ</title>
    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css"
      rel="stylesheet"
    />
  </head>
  <body>
    <nav class="navbar navbar-expand-lg navbar-dark bg-dark px-3">
      <a class="navbar-brand" href="#">–ü—Ä–∏–≥–ª–∞—Å–∏—Ç–µ–ª—å–Ω—ã–µ</a>
      <button
        class="navbar-toggler"
        type="button"
        data-bs-toggle="collapse"
        data-bs-target="#navbarNav"
      >
        <span class="navbar-toggler-icon"></span>
      </button>

      <div class="collapse navbar-collapse" id="navbarNav">
        <ul class="navbar-nav ms-3">
          <li class="nav-item">
            <a class="nav-link active" href="create.html">–û—Ç–ø—Ä–∞–≤–∏—Ç—å</a>
          </li>
          <li class="nav-item">
            <a class="nav-link" href="guests.html">–°–ø–∏—Å–æ–∫ –≥–æ—Å—Ç–µ–π</a>
          </li>
          <li class="nav-item">
            <a class="nav-link" href="invites.html">–°–ø–∏—Å–æ–∫ –ø—Ä–∏–≥–ª–∞—à–µ–Ω–∏–π</a>
          </li>
        </ul>
      </div>
    </nav>

    <main class="container my-4">
      <h2>üì® –û—Ç–ø—Ä–∞–≤–∫–∞ –æ–¥–Ω–æ–≥–æ –ø—Ä–∏–≥–ª–∞—Å–∏—Ç–µ–ª—å–Ω–æ–≥–æ –Ω–∞ –≥—Ä—É–ø–ø—É –≥–æ—Å—Ç–µ–π</h2>

      <form id="guestForm" class="mb-3">
        <div id="guestFields">
          <div class="input-group mb-2">
            <input
              type="text"
              class="form-control"
              name="guestName"
              placeholder="–ò–º—è –≥–æ—Å—Ç—è"
            />
            <button
              type="button"
              class="btn btn-outline-secondary"
              onclick="addGuestField()"
            >
              +
            </button>
          </div>
        </div>
        <button type="submit" class="btn btn-primary">
          –°–æ–∑–¥–∞—Ç—å –ø—Ä–∏–≥–ª–∞—Å–∏—Ç–µ–ª—å–Ω—ã–π
        </button>
      </form>

      <div id="results" class="mt-4"></div>
    </main>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <script>
      function addGuestField() {
        const container = document.getElementById("guestFields");
        const div = document.createElement("div");
        div.className = "input-group mb-2";
        div.innerHTML = `
        <input type="text" class="form-control" name="guestName" placeholder="–ò–º—è –≥–æ—Å—Ç—è" />
        <button type="button" class="btn btn-outline-danger" onclick="this.parentElement.remove()">‚àí</button>
      `;
        container.appendChild(div);
      }

      document
        .getElementById("guestForm")
        .addEventListener("submit", function (e) {
          e.preventDefault();

          const rawInputs = document.querySelectorAll(
            'input[name="guestName"]'
          );
          const names = Array.from(rawInputs)
            .map((input) => input.value.trim())
            .filter((name) => name.length > 0);

          const isNamed = names.length > 0;
          const inviteId = isNamed
            ? "invite_" + Math.random().toString(36).substring(2, 10)
            : "";
          const url = isNamed
            ? `https://justmre.github.io/invite-site/index.html?invite=${inviteId}`
            : `https://justmre.github.io/invite-site/index.html`;

          const invite = {
            id: inviteId,
            guests: names, // –º–æ–∂–µ—Ç –±—ã—Ç—å –ø—É—Å—Ç—ã–º ‚Äî —ç—Ç–æ –Ω–µ–∏–º–µ–Ω–Ω–æ–π –ø—Ä–∏–≥–ª–∞—Å–∏—Ç–µ–ª—å–Ω—ã–π
            status: "pending",
          };

          saveInvite(invite);

          const resultDiv = document.getElementById("results");
          resultDiv.innerHTML = `
        <h4>–°–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞–Ω –ø—Ä–∏–≥–ª–∞—Å–∏—Ç–µ–ª—å–Ω—ã–π:</h4>
        <div class="input-group">
          <input type="text" class="form-control" value="${url}" readonly>
          <button class="btn btn-primary" onclick="window.open('${url}', '_blank')">–û—Ç–∫—Ä—ã—Ç—å</button>
        </div>
      `;
        });
      
      function saveInvite(invite) {
        const formData = new URLSearchParams();
        formData.append("type", "rsvp");
        formData.append("inviteId", invite.id || "");
        formData.append("name", invite.guests);
        formData.append("status", invite.status);
        
        fetch("https://script.google.com/macros/s/AKfycbxfNTanfQH3eoCAoW4CErPmk6kh5BT5l3ZwMyJa9nnDxXFCCl6PwCJFKak8HXRQV9MxLg/exec", {
          method: "POST",
          body: formData
        });
        // fetch(
        //   "https://script.google.com/macros/s/AKfycbxfNTanfQH3eoCAoW4CErPmk6kh5BT5l3ZwMyJa9nnDxXFCCl6PwCJFKak8HXRQV9MxLg/exec",
        //   {
        //     method: "POST",
        //     body: JSON.stringify({
        //       type: "invite",
        //       inviteId: invite.id || "",
        //       guests: invite.guests,
        //     }),
        //     headers: { "Content-Type": "application/json" },
        //   }
        // );
      }
    </script>
  </body>
</html>
