<!DOCTYPE html>
<html lang="ru">
  <head>
    <meta charset="UTF-8" />
    <title>–û—Ç–ø—Ä–∞–≤–∏—Ç—å –ø—Ä–∏–≥–ª–∞—Å–∏—Ç–µ–ª—å–Ω–æ–µ</title>
    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css"
      rel="stylesheet"
    />
  </head>
  <body>
    <nav class="navbar navbar-expand-lg navbar-dark bg-dark px-3">
      <a class="navbar-brand" href="#">–ü—Ä–∏–≥–ª–∞—Å–∏—Ç–µ–ª—å–Ω—ã–µ</a>
      <div class="collapse navbar-collapse">
        <ul class="navbar-nav ms-3">
          <li class="nav-item">
            <a class="nav-link active" href="create.html">–û—Ç–ø—Ä–∞–≤–∏—Ç—å</a>
          </li>
          <li class="nav-item">
            <a class="nav-link" href="guests.html">–°–ø–∏—Å–æ–∫ –≥–æ—Å—Ç–µ–π</a>
          </li>
          <li class="nav-item">
            <a class="nav-link" href="invites.html">–°–ø–∏—Å–æ–∫ –ø—Ä–∏–≥–ª–∞—à–µ–Ω–∏–π</a>
          </li>
        </ul>
      </div>
    </nav>

    <main class="container my-4">
      <h2>üì® –û—Ç–ø—Ä–∞–≤–∫–∞ –æ–¥–Ω–æ–≥–æ –ø—Ä–∏–≥–ª–∞—Å–∏—Ç–µ–ª—å–Ω–æ–≥–æ –Ω–∞ –≥—Ä—É–ø–ø—É –≥–æ—Å—Ç–µ–π</h2>

      <form class="mb-3">
        <div id="guestFields">
          <div class="input-group mb-2">
            <input
              type="text"
              class="form-control guest-name-input"
              placeholder="–ò–º—è –≥–æ—Å—Ç—è"
            />
            <button
              type="button"
              class="btn btn-outline-secondary"
              onclick="addGuestField()"
            >
              +
            </button>
          </div>
        </div>
        <button type="button" class="btn btn-primary" onclick="createInvite()">
          –°–æ–∑–¥–∞—Ç—å –ø—Ä–∏–≥–ª–∞—Å–∏—Ç–µ–ª—å–Ω—ã–π
        </button>
      </form>

      <div id="results" class="mt-4"></div>
    </main>

    <!-- Firebase SDK -->
    <script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-database-compat.js"></script>

    <script>
      // Firebase config
      const firebaseConfig = {
        apiKey: "AIzaSyAXb5k4WAUbXI3zlXt-J0jPprO837zr8v8",
        authDomain: "toiinvite2025.firebaseapp.com",
        databaseURL: "https://toiinvite2025-default-rtdb.firebaseio.com",
        projectId: "toiinvite2025",
        storageBucket: "toiinvite2025.appspot.com",
        messagingSenderId: "228773799390",
        appId: "1:228773799390:web:2ae10163590ff87e1c294f",
      };
      firebase.initializeApp(firebaseConfig);
    </script>

    <script>
      function addGuestField() {
        const container = document.getElementById("guestFields");
        const div = document.createElement("div");
        div.className = "input-group mb-2";
        div.innerHTML = `
          <input type="text" class="form-control guest-name-input" placeholder="–ò–º—è –≥–æ—Å—Ç—è" />
          <button type="button" class="btn btn-outline-danger" onclick="this.parentElement.remove()">‚àí</button>
        `;
        container.appendChild(div);
      }

      function createInvite() {
        const guestInputs = document.querySelectorAll(".guest-name-input");
        const guestNames = [];

        guestInputs.forEach((input) => {
          const name = input.value.trim();
          if (name !== "") guestNames.push(name);
        });

        const inviteId = Math.random().toString(36).substr(2, 9);
        const resultDiv = document.getElementById("results");

        // –ï—Å–ª–∏ –∏–º–µ–Ω–∞ –Ω–µ —É–∫–∞–∑–∞–Ω—ã ‚Äî –ø—Ä–æ—Å—Ç–æ –≤—ã–≤–æ–¥–∏–º –æ–±—â–∏–π URL –±–µ–∑ –∑–∞–ø–∏—Å–∏ –≤ –±–∞–∑—É
        if (guestNames.length === 0) {
          const url = `index.html`;
          const adr = `${location.origin}/${url}`;
          resultDiv.innerHTML = `
      <h4>–°–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞–Ω –Ω–µ–∏–º–µ–Ω–Ω–æ–π –ø—Ä–∏–≥–ª–∞—Å–∏—Ç–µ–ª—å–Ω—ã–π:</h4>
      <div class="input-group">
        <input type="text" class="form-control" value="${adr}" readonly>
        <button class="btn btn-primary" onclick="window.open('${adr}', '_blank')">–û—Ç–∫—Ä—ã—Ç—å</button>
      </div>
    `;
          return;
        }

        // –ï—Å–ª–∏ –∏–º–µ–Ω–∞ –µ—Å—Ç—å ‚Äî —Å–æ—Ö—Ä–∞–Ω—è–µ–º –≤ –±–∞–∑—É
        const db = firebase.database();
        db.ref("invites/" + inviteId)
          .set({
            guests: guestNames,
            created: new Date().toISOString(),
          })
          .then(() => {
            const url = `index.html?invite=${inviteId}`;
            const adr = `${location.origin}/${url}`;
            resultDiv.innerHTML = `
        <h4>–°–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞–Ω –∏–º–µ–Ω–Ω–æ–π –ø—Ä–∏–≥–ª–∞—Å–∏—Ç–µ–ª—å–Ω—ã–π:</h4>
        <div class="input-group">
          <input type="text" class="form-control" value="${adr}" readonly>
          <button class="btn btn-primary" onclick="window.open('${adr}', '_blank')">–û—Ç–∫—Ä—ã—Ç—å</button>
        </div>
      `;
          });
      }
    </script>
  </body>
</html>
