<!DOCTYPE html>
<html lang="ru">
  <head>
    <meta charset="UTF-8" />
    <title>–°–ø–∏—Å–æ–∫ –ø—Ä–∏–≥–ª–∞—à–µ–Ω–∏–π</title>
    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css"
      rel="stylesheet"
    />
  </head>
  <body>
    <nav class="navbar navbar-expand-lg navbar-dark bg-dark px-3">
      <a class="navbar-brand" href="#">–ü—Ä–∏–≥–ª–∞—Å–∏—Ç–µ–ª—å–Ω—ã–µ</a>
      <button
        class="navbar-toggler"
        type="button"
        data-bs-toggle="collapse"
        data-bs-target="#navbarNav"
      >
        <span class="navbar-toggler-icon"></span>
      </button>
      <div class="collapse navbar-collapse" id="navbarNav">
        <ul class="navbar-nav ms-3">
          <li class="nav-item">
            <a class="nav-link" href="create.html">–û—Ç–ø—Ä–∞–≤–∏—Ç—å</a>
          </li>
          <li class="nav-item">
            <a class="nav-link" href="guests.html">–°–ø–∏—Å–æ–∫ –≥–æ—Å—Ç–µ–π</a>
          </li>
          <li class="nav-item">
            <a class="nav-link active" href="invites.html"
              >–°–ø–∏—Å–æ–∫ –ø—Ä–∏–≥–ª–∞—à–µ–Ω–∏–π</a
            >
          </li>
        </ul>
      </div>
    </nav>

    <main class="container mt-4">
      <h2>üì® –°–ø–∏—Å–æ–∫ –ø—Ä–∏–≥–ª–∞—à–µ–Ω–∏–π</h2>
      <div id="invitesList" class="mt-3"></div>
    </main>

    <script>
      const fetchUrl =
        "https://script.google.com/macros/s/AKfycbxfNTanfQH3eoCAoW4CErPmk6kh5BT5l3ZwMyJa9nnDxXFCCl6PwCJFKak8HXRQV9MxLg/exec";

      fetch(fetchUrl)
        .then((res) => res.json())
        .then((invites) => {
          const container = document.getElementById("invitesList");
          if (!invites.length) {
            container.innerHTML = "<p>–ù–µ—Ç –ø—Ä–∏–≥–ª–∞—à–µ–Ω–∏–π</p>";
            return;
          }

          invites.forEach((row, i) => {
            const isNamed = row["–ì–æ—Å—Ç–∏"].trim() !== "";
            const guestsText = isNamed ? row["–ì–æ—Å—Ç–∏"] : "<em>–ù–µ–∏–º–µ–Ω–Ω–æ–π</em>";
            const url = isNamed
              ? `https://toisait.kz/index.html?invite=${row["Invite ID"]}`
              : `https://toisait.kz/index.html`;

            const status =
              row["–°—Ç–∞—Ç—É—Å"] === "yes"
                ? "‚úÖ –ü—Ä–∏–¥—É—Ç"
                : row["–°—Ç–∞—Ç—É—Å"] === "no"
                ? "‚ùå –ù–µ –ø—Ä–∏–¥—É—Ç"
                : "‚è≥ –ë–µ–∑ –æ—Ç–≤–µ—Ç–∞";

            const card = document.createElement("div");
            card.className = "card mb-3";
            card.innerHTML = `
        <div class="card-body">
          <h5 class="card-title">–ü—Ä–∏–≥–ª–∞—Å–∏—Ç–µ–ª—å–Ω—ã–π #${i + 1}</h5>
          <p class="card-text"><strong>–ì–æ—Å—Ç–∏:</strong> ${guestsText}</p>
          <p class="card-text"><strong>–°—Ç–∞—Ç—É—Å:</strong> ${status}</p>
          <a href="${url}" target="_blank" class="btn btn-primary">–û—Ç–∫—Ä—ã—Ç—å</a>
        </div>
      `;
            container.appendChild(card);
          });
        });

      function doGet() {
        const sheet =
          SpreadsheetApp.getActiveSpreadsheet().getSheetByName(
            "–ü—Ä–∏–≥–ª–∞—Å–∏—Ç–µ–ª—å–Ω—ã–µ"
          );
        const data = sheet.getDataRange().getValues();
        const headers = data[0];
        const rows = data.slice(1);

        const json = rows.map((row) => {
          const obj = {};
          headers.forEach((h, i) => (obj[h] = row[i]));
          return obj;
        });

        return ContentService.createTextOutput(
          JSON.stringify(json)
        ).setMimeType(ContentService.MimeType.JSON);
      }
    </script>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
  </body>
</html>
