<!DOCTYPE html>
<html lang="ru">
  <head>
    <meta charset="UTF-8" />
    <title>–°–ø–∏—Å–æ–∫ –ø—Ä–∏–≥–ª–∞—à–µ–Ω–∏–π</title>
    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css"
      rel="stylesheet"
    />
  </head>
  <body>
    <nav class="navbar navbar-expand-lg navbar-dark bg-dark px-3">
      <a class="navbar-brand" href="#">–ü—Ä–∏–≥–ª–∞—Å–∏—Ç–µ–ª—å–Ω—ã–µ</a>
      <div class="collapse navbar-collapse">
        <ul class="navbar-nav ms-3">
          <li class="nav-item">
            <a class="nav-link" href="create.html">–û—Ç–ø—Ä–∞–≤–∏—Ç—å</a>
          </li>
          <li class="nav-item">
            <a class="nav-link" href="guests.html">–°–ø–∏—Å–æ–∫ –≥–æ—Å—Ç–µ–π</a>
          </li>
          <li class="nav-item">
            <a class="nav-link active" href="invites.html"
              >–°–ø–∏—Å–æ–∫ –ø—Ä–∏–≥–ª–∞—à–µ–Ω–∏–π</a
            >
          </li>
        </ul>
      </div>
    </nav>

    <main class="container mt-4">
      <h2>üì® –°–ø–∏—Å–æ–∫ —Å–æ–∑–¥–∞–Ω–Ω—ã—Ö –ø—Ä–∏–≥–ª–∞—à–µ–Ω–∏–π</h2>
      <table class="table table-striped">
        <thead>
          <tr>
            <th>–î–∞—Ç–∞</th>
            <th>ID</th>
            <th>–ì–æ—Å—Ç–∏</th>
            <th>–°—Å—ã–ª–∫–∞</th>
          </tr>
        </thead>
        <tbody id="invitesTableBody"></tbody>
      </table>
    </main>

    <!-- Firebase SDK -->
    <script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-database-compat.js"></script>

    <script>
      const firebaseConfig = {
        apiKey: "AIzaSyAXb5k4WAUbXI3zlXt-J0jPprO837zr8v8",
        authDomain: "toiinvite2025.firebaseapp.com",
        databaseURL: "https://toiinvite2025-default-rtdb.firebaseio.com",
        projectId: "toiinvite2025",
        storageBucket: "toiinvite2025.appspot.com",
        messagingSenderId: "228773799390",
        appId: "1:228773799390:web:2ae10163590ff87e1c294f",
      };
      firebase.initializeApp(firebaseConfig);
    </script>

    <script>
      const db = firebase.database();

      db.ref("invites")
        .once("value")
        .then((snapshot) => {
          const tableBody = document.getElementById("invitesTableBody");
          const invites = snapshot.val();

          if (!invites) {
            tableBody.innerHTML = '<tr><td colspan="4">–ù–µ—Ç –¥–∞–Ω–Ω—ã—Ö</td></tr>';
            return;
          }

          Object.entries(invites).forEach(([id, data]) => {
            const guests = (data.guests || []).join(", ");
            const link =
              data.guests && data.guests.length > 0
                ? `${location.origin}/invite-site/index.html?invite=${id}`
                : `${location.origin}/invite-site/index.html`;

            const row = document.createElement("tr");
            row.innerHTML = `
            <td>${new Date(data.created).toLocaleString()}</td>
            <td>${id}</td>
            <td>${guests || "‚Äî"}</td>
            <td><a href="${link}" target="_blank">–û—Ç–∫—Ä—ã—Ç—å</a></td>
          `;
            tableBody.appendChild(row);
          });
        });
    </script>
  </body>
</html>
