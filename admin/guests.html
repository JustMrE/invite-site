<!DOCTYPE html>
<html lang="ru">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>–°–ø–∏—Å–æ–∫ –≥–æ—Å—Ç–µ–π</title>
    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css"
      rel="stylesheet"
    />
    <style>
      .status-yes { background-color: #d4edda; color: #155724; font-weight: bold; }
      .status-no { background-color: #f8d7da; color: #721c24; font-weight: bold; }
      .status-pending { background-color: #fff3cd; color: #856404; font-weight: bold; }
      .invite-block { border: 1px solid #ccc; border-radius: 8px; padding: 12px; margin-bottom: 16px; }
      .invite-header { display: flex; justify-content: space-between; align-items: center; }
      .sortable:hover { cursor: pointer; text-decoration: underline; }
    </style>
    <script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-database-compat.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
  </head>
  <body>
    <nav class="navbar navbar-expand-lg navbar-dark bg-dark px-3">
      <a class="navbar-brand" href="#">–ü—Ä–∏–≥–ª–∞—Å–∏—Ç–µ–ª—å–Ω—ã–µ</a>
      <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNav">
        <span class="navbar-toggler-icon"></span>
      </button>
      <div class="collapse navbar-collapse" id="navbarNav">
        <ul class="navbar-nav ms-3">
          <li class="nav-item"><a class="nav-link" href="create.html">–û—Ç–ø—Ä–∞–≤–∏—Ç—å</a></li>
          <li class="nav-item"><a class="nav-link active" href="guests.html">–°–ø–∏—Å–æ–∫ –≥–æ—Å—Ç–µ–π</a></li>
          <li class="nav-item"><a class="nav-link" href="invites.html">–°–ø–∏—Å–æ–∫ –ø—Ä–∏–≥–ª–∞—à–µ–Ω–∏–π</a></li>
        </ul>
      </div>
    </nav>

    <main class="container mt-4">
      <h2 class="mb-3">üìã –°–ø–∏—Å–æ–∫ –≥–æ—Å—Ç–µ–π</h2>
      <div class="mb-3">
        <label for="sortField" class="form-label">–°–æ—Ä—Ç–∏—Ä–æ–≤–∞—Ç—å –ø–æ:</label>
        <select id="sortField" class="form-select w-auto d-inline-block">
          <option value="name">–ò–º—è</option>
          <option value="created">–î–∞—Ç–∞</option>
          <option value="type">–¢–∏–ø</option>
          <option value="status">–°—Ç–∞—Ç—É—Å</option>
        </select>
      </div>
      <div id="invitesContainer"></div>
    </main>

    <script>
      const firebaseConfig = {
        apiKey: "AIzaSyAXb5k4WAUbXI3zlXt-J0jPprO837zr8v8",
        authDomain: "toiinvite2025.firebaseapp.com",
        databaseURL: "https://toiinvite2025-default-rtdb.firebaseio.com",
        projectId: "toiinvite2025",
        storageBucket: "toiinvite2025.appspot.com",
        messagingSenderId: "228773799390",
        appId: "1:228773799390:web:2ae10163590ff87e1c294f",
      };
      firebase.initializeApp(firebaseConfig);
      const db = firebase.database();

      const container = document.getElementById("invitesContainer");
      const sortField = document.getElementById("sortField");

      const statusMap = {
        yes: { text: "“ö–∞—Ç—ã—Å–∞–¥—ã", class: "status-yes" },
        no: { text: "“ö–∞—Ç—ã—Å–ø–∞–π–¥—ã", class: "status-no" },
        pending: { text: "–ñ–∞—É–∞–ø –∂–æ“õ", class: "status-pending" },
      };

      function render() {
        container.innerHTML = "–ó–∞–≥—Ä—É–∑–∫–∞...";
        db.ref("invites").once("value").then(snapshot => {
          const invites = snapshot.val() || {};
          const inviteList = Object.entries(invites).map(([id, invite]) => {
            return {
              id,
              created: invite.created,
              guests: invite.guests || [],
              status: invite.status || "pending",
              type: invite.type || "named"
            };
          });

          const field = sortField.value;
          inviteList.sort((a, b) => {
            if (field === "name") return (a.guests[0] || "").localeCompare(b.guests[0] || "");
            if (field === "created") return new Date(b.created) - new Date(a.created);
            if (field === "type") return a.type.localeCompare(b.type);
            if (field === "status") return a.status.localeCompare(b.status);
            return 0;
          });

          container.innerHTML = "";
          inviteList.forEach(invite => {
            const statusInfo = statusMap[invite.status] || statusMap.pending;
            const div = document.createElement("div");
            div.className = "invite-block";
            div.innerHTML = `
              <div class="invite-header">
                <strong>–ü—Ä–∏–≥–ª–∞—Å–∏—Ç–µ–ª—å–Ω—ã–π ID: ${invite.id}</strong>
                <button class="btn btn-sm btn-outline-primary" onclick="window.location='invites.html#${invite.id}'">–†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å</button>
              </div>
              <p><strong>–î–∞—Ç–∞:</strong> ${new Date(invite.created).toLocaleString()}</p>
              <p><strong>–¢–∏–ø:</strong> ${invite.type === "named" ? "–ò–º–µ–Ω–Ω–æ–π" : "–ù–µ–∏–º–µ–Ω–Ω–æ–π"}</p>
              <p><strong>–°—Ç–∞—Ç—É—Å:</strong> <span class="${statusInfo.class}">${statusInfo.text}</span></p>
              <p><strong>–ì–æ—Å—Ç–∏:</strong><br>${invite.guests.map(g => `‚Ä¢ ${g}`).join("<br>")}</p>
            `;
            container.appendChild(div);
          });
        });
      }

      sortField.addEventListener("change", render);
      render();
    </script>
  </body>
</html>
