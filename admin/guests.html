<!DOCTYPE html>
<html lang="ru">
  <head>
    <meta charset="UTF-8" />
    <title>–°–ø–∏—Å–æ–∫ –≥–æ—Å—Ç–µ–π</title>
    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css"
      rel="stylesheet"
    />
    <style>
      .status-yes {
        background-color: #d4edda;
        color: #155724;
        font-weight: bold;
      }
      .status-no {
        background-color: #f8d7da;
        color: #721c24;
        font-weight: bold;
      }
      .status-pending {
        background-color: #fff3cd;
        color: #856404;
        font-weight: bold;
      }
    </style>
    <script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-database-compat.js"></script>
  </head>
  <body>
    <nav class="navbar navbar-expand-lg navbar-dark bg-dark px-3">
      <a class="navbar-brand" href="#">–ü—Ä–∏–≥–ª–∞—Å–∏—Ç–µ–ª—å–Ω—ã–µ</a>
      <ul class="navbar-nav ms-3">
        <li class="nav-item">
          <a class="nav-link" href="create.html">–û—Ç–ø—Ä–∞–≤–∏—Ç—å</a>
        </li>
        <li class="nav-item">
          <a class="nav-link active" href="guests.html">–°–ø–∏—Å–æ–∫ –≥–æ—Å—Ç–µ–π</a>
        </li>
        <li class="nav-item">
          <a class="nav-link" href="invites.html">–°–ø–∏—Å–æ–∫ –ø—Ä–∏–≥–ª–∞—à–µ–Ω–∏–π</a>
        </li>
      </ul>
    </nav>

    <main class="container mt-4">
      <h2>üìã –°–ø–∏—Å–æ–∫ –≥–æ—Å—Ç–µ–π</h2>
      <table class="table table-striped">
        <thead>
          <tr>
            <th>–î–∞—Ç–∞</th>
            <th>–ò–º—è</th>
            <th>–¢–∏–ø</th>
            <th>–°—Ç–∞—Ç—É—Å</th>
          </tr>
        </thead>
        <tbody id="guestTableBody"></tbody>
      </table>
    </main>

    <script>
      // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è Firebase
      const firebaseConfig = {
        apiKey: "AIzaSyAXb5k4WAUbXI3zlXt-J0jPprO837zr8v8",
        authDomain: "toiinvite2025.firebaseapp.com",
        databaseURL: "https://toiinvite2025-default-rtdb.firebaseio.com",
        projectId: "toiinvite2025",
        storageBucket: "toiinvite2025.appspot.com",
        messagingSenderId: "228773799390",
        appId: "1:228773799390:web:2ae10163590ff87e1c294f",
      };
      firebase.initializeApp(firebaseConfig);

      const db = firebase.database();
      const tbody = document.getElementById("guestTableBody");

      // –ó–∞–≥—Ä—É–∂–∞–µ–º –≤—Å–µ –ø—Ä–∏–≥–ª–∞—à–µ–Ω–∏—è
      db.ref("invites")
        .once("value")
        .then((snapshot) => {
          const data = snapshot.val() || {};
          Object.entries(data).forEach(([inviteId, invite]) => {
            const guests = invite.guests || [];
            const created = new Date(invite.created).toLocaleString();
            const status = invite.status || "pending";

            let statusText, statusClass;
            switch (status) {
              case "yes":
                statusText = "“ö–∞—Ç—ã—Å–∞–¥—ã";
                statusClass = "status-yes";
                break;
              case "no":
                statusText = "“ö–∞—Ç—ã—Å–ø–∞–π–¥—ã";
                statusClass = "status-no";
                break;
              default:
                statusText = "–ñ–∞—É–∞–ø –∂–æ“õ";
                statusClass = "status-pending";
                break;
            }

            const typeText = guests.length > 0 ? "–ò–º–µ–Ω–Ω–æ–π" : "–ù–µ–∏–º–µ–Ω–Ω–æ–π";

            if (guests.length === 0) {
              const tr = document.createElement("tr");
              tr.innerHTML = `
          <td>${created}</td>
          <td>‚Äî</td>
          <td>${typeText}</td>
          <td>
            <p class="${statusClass}">
              ${statusText}
            </p>
          </td>
        `;
              tbody.appendChild(tr);
            } else {
              guests.forEach((name) => {
                const tr = document.createElement("tr");
                tr.innerHTML = `
            <td>${created}</td>
            <td>${name}</td>
            <td>${typeText}</td>
            <td>
            <p class="${statusClass}">
              ${statusText}
            </p>
          </td>
          `;
                tbody.appendChild(tr);
              });
            }
          });
        });
    </script>
  </body>
</html>
