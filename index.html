<!DOCTYPE html>
<html lang="kk">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Тойға шақыру</title>
    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css"
      rel="stylesheet"
    />
    <link
      href="https://fonts.googleapis.com/css2?family=Pacifico&display=swap"
      rel="stylesheet"
    />
    <link rel="stylesheet" href="./css/style.css" />
    <script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.6.0/dist/confetti.browser.min.js"></script>
  </head>
  <body onload="launchConfetti()">
    <div class="falling-stars" id="fallingStars"></div>
    <div class="balloon-container" id="balloonContainer"></div>
    <div class="lang-toggle">
      <button class="btn btn-outline-secondary" onclick="toggleLang()">
        Қазақша / Русский
      </button>
    </div>
    <header>
      <h1 id="mainTitle">Тойға шақыру</h1>
    </header>

    <section class="section" id="eventDescription">
      <h2 id="guestGreeting">Құрметті қонақтар:</h2>
      <p>Сізді біздің қуанышымызға ортақтасуға шақырамыз:</p>
      <ul>
        <li>Қызымыздың 7 жасқа толып, мектепке баруы — Тілашар</li>
        <li>Ұлымыздың сүндетке отырғызуы</li>
        <li>Кішкентай ханшайымымыздың дүниеге келуі — Бесік той</li>
      </ul>
      <p><strong>Той иелері:</strong> Бауржан, Қамар</p>

      <div class="rainbow-overlay">
        <svg
          class="rainbow-svg"
          viewBox="0 0 600 300"
          xmlns="http://www.w3.org/2000/svg"
        >
          <defs>
            <radialGradient id="cloudGradient" cx="50%" cy="50%" r="50%">
              <stop offset="0%" stop-color="#ffffff" stop-opacity="1" />
              <stop offset="100%" stop-color="#e0e0e0" stop-opacity="1" />
            </radialGradient>
            <filter
              id="cloudShadow"
              x="-50%"
              y="-50%"
              width="200%"
              height="200%"
            >
              <feDropShadow
                dx="2"
                dy="4"
                stdDeviation="4"
                flood-color="#000"
                flood-opacity="0.2"
              />
            </filter>
          </defs>

          <g class="rainbow-group">
            <path class="arc arc1" d="M100,250 A200,200 0 0,1 500,250" />
            <path class="arc arc2" d="M110,250 A190,190 0 0,1 490,250" />
            <path class="arc arc3" d="M120,250 A180,180 0 0,1 480,250" />
            <path class="arc arc4" d="M130,250 A170,170 0 0,1 470,250" />
            <path class="arc arc5" d="M140,250 A160,160 0 0,1 460,250" />
            <path class="arc arc6" d="M150,250 A150,150 0 0,1 450,250" />
            <path class="arc arc7" d="M160,250 A140,140 0 0,1 440,250" />
          </g>

          <g class="cloudShape">
            <ellipse cx="110" cy="250" rx="40" ry="25" />
            <ellipse cx="130" cy="240" rx="35" ry="20" />
            <ellipse cx="150" cy="255" rx="45" ry="25" />
          </g>

          <g class="cloudShape">
            <ellipse cx="490" cy="250" rx="40" ry="25" />
            <ellipse cx="470" cy="240" rx="35" ry="20" />
            <ellipse cx="450" cy="255" rx="45" ry="25" />
          </g>
        </svg>
      </div>
    </section>

    <section class="section" id="eventDetails">
      <h2>Кездесу орны мен уақыты</h2>
      <p><strong>15 маусым 2025, 14:00</strong></p>
      <p>Ресторан "Алтын Ел", пр. Дулати 55</p>
      <iframe
        class="map"
        src="https://widgets.2gis.com/widget?type=firm&regionId=56&firmId=70000001025292888"
      ></iframe>
    </section>

    <section class="section" id="rsvp">
      <h2 id="submitCome">Қатысатыныңызды растаңыз</h2>

      <form id="rsvpForm" class="needs-validation" novalidate>
        <div class="mb-3">
          <label id="guestNameLabel" class="form-label">Сіздің атыңыз:</label>
          <input
            type="text"
            class="form-control"
            id="guestName"
            placeholder="Атыңыз"
            required
          />
        </div>

        <button type="submit" class="btn btn-success">Қатысамын</button>
        <button
          type="button"
          class="btn btn-outline-secondary ms-2"
          onclick="denyAttendance()"
        >
          Қатыспаймын
        </button>
      </form>

      <p id="thanksMsg" class="mt-3 text-success fw-bold" style="display: none">
        Рақмет, күтеміз!
      </p>
      <p id="sorryMsg" class="mt-3 text-danger fw-bold" style="display: none">
        Қап, өкінішті. Келесі жолы!
      </p>
    </section>

    <!-- <script>
      document.addEventListener("DOMContentLoaded", () => {
        const inviteId = new URLSearchParams(window.location.search).get(
          "invite"
        );
        const allInvites = JSON.parse(localStorage.getItem("invites") || "[]");
        const invite = allInvites.find((i) => i.id === inviteId);

        const form = document.getElementById("rsvpForm");
        const guestNameInput = document.getElementById("guestName");
        const guestNameLabel = document.getElementById("guestNameLabel");
        const nameInputBlock = guestNameInput?.closest(".mb-3");
        const greeting = document.getElementById("guestGreeting");
        const heading = document.querySelector("#rsvp h2");
        const thanksMsg = document.getElementById("thanksMsg");
        const sorryMsg = document.getElementById("sorryMsg");

        if (!invite) {
          heading.innerText = "Қонақтар табылмады.";
          form.style.display = "none";
          return;
        }

        // Определяем: именной ли пригласительный
        const isNamedInvite =
          Array.isArray(invite.guests) &&
          invite.guests.some((name) => name.trim().length > 0);

        // Отображаем заголовок и поле ввода
        if (isNamedInvite) {
          const namesText = invite.guests
            .filter((name) => name.trim().length > 0)
            .join(", ");
          greeting.innerText = `Құрметті ${namesText}!`;
          heading.innerText = `Құрметті ${namesText}! Қатысатыныңызды растаңыз`;
          if (nameInputBlock) nameInputBlock.style.display = "none";
        } else {
          greeting.innerText = `Құрметті қонақтар!`;
          heading.innerText = "Құрметті қонақ! Қатысатыныңызды растаңыз";
          if (nameInputBlock) nameInputBlock.style.display = "block";
        }

        // Обработка уже отправленного ответа
        if (invite.status === "yes") {
          form.style.display = "none";
          thanksMsg.style.display = "block";
        } else if (invite.status === "no") {
          form.style.display = "none";
          sorryMsg.style.display = "block";
        }

        // Обработка подтверждения "Қатысамын"
        form.addEventListener("submit", function (e) {
          e.preventDefault();
          invite.status = "yes";

          if (!isNamedInvite) {
            invite.respondedName = guestNameInput.value.trim();
          }

          localStorage.setItem("invites", JSON.stringify(allInvites));
          form.style.display = "none";
          thanksMsg.style.display = "block";
        });

        // Обработка отказа "Қатыспаймын"
        window.denyAttendance = function () {
          invite.status = "no";

          if (!isNamedInvite) {
            invite.respondedName = guestNameInput.value.trim();
          }

          localStorage.setItem("invites", JSON.stringify(allInvites));
          form.style.display = "none";
          sorryMsg.style.display = "block";
        };
      });
    </script> -->

    <section class="section" id="countdown">
      <h2>Қалған уақыт</h2>
      <div class="countdown-wrapper">
        <div class="time-box">
          <span id="days">00</span>
          <small>күн</small>
        </div>
        <div class="time-box">
          <span id="hours">00</span>
          <small>сағат</small>
        </div>
        <div class="time-box">
          <span id="minutes">00</span>
          <small>минут</small>
        </div>
        <div class="time-box">
          <span id="seconds">00</span>
          <small>секунд</small>
        </div>
      </div>
    </section>

    <script>
      document.addEventListener("DOMContentLoaded", () => {
        const params = new URLSearchParams(location.search);
        const inviteId = params.get("invite");
        const isNamed = !!inviteId;

        const guestNameInput = document.getElementById("guestName");
        const nameInputBlock = guestNameInput.closest(".mb-3");
        const form = document.getElementById("rsvpForm");
        const thanksMsg = document.getElementById("thanksMsg");
        const sorryMsg = document.getElementById("sorryMsg");

        const greeting = document.getElementById("guestGreeting");
        const submitCome = document.getElementById("submitCome");

        // Скрываем поле имени, если приглашение именное
        if (isNamed) {
          // Получаем список гостей по inviteId из Google Таблицы
          fetch(
            `https://script.google.com/macros/s/AKfycbxfNTanfQH3eoCAoW4CErPmk6kh5BT5l3ZwMyJa9nnDxXFCCl6PwCJFKak8HXRQV9MxLg/exec?invite=${inviteId}`
          )
            .then((res) => res.text())
            .then((names) => {
              names = names.trim();
              greeting.innerText = `Құрметті ${names}!`;
              submitCome.innerText = `Құрметті ${names}! Қатысатыныңызды растаңыз.`;
            });

          nameInputBlock.style.display = "none";
        } else {
          nameInputBlock.style.display = "block";
        }

        form.addEventListener("submit", function (e) {
          e.preventDefault();
          sendRSVP("yes");
        });

        window.denyAttendance = function () {
          sendRSVP("no");
        };

        function sendRSVP(status) {
          const name = isNamed
            ? "" // в будущем можно вставить имя из invite
            : guestNameInput.value.trim();

          if (!isNamed && name === "") {
            alert("Атыңызды енгізіңіз");
            return;
          }

          fetch(
            "https://script.google.com/macros/s/AKfycbxfNTanfQH3eoCAoW4CErPmk6kh5BT5l3ZwMyJa9nnDxXFCCl6PwCJFKak8HXRQV9MxLg/exec",
            {
              method: "POST",
              headers: { "Content-Type": "application/json" },
              body: JSON.stringify({
                type: "rsvp",
                inviteId: inviteId || "",
                name,
                status,
              }),
            }
          ).then(() => {
            form.style.display = "none";
            if (status === "yes") {
              thanksMsg.style.display = "block";
            } else {
              sorryMsg.style.display = "block";
            }
          });
        }
      });
    </script>
    <script src="./js/script.js"></script>
  </body>
</html>
